<!DOCTYPE html>
<html>
<!-- this is index.html-->

<head>
    <title>Welcome to PawFridge!</title>
    <link rel="stylesheet" href="./styles.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script>
  // Fetch the User IDs
    let selectedUserID = 1;
    
    function fetchUserIDs() {
    var userList = document.getElementById("user-list");

    // Add a click event listener to the dropdown
    userList.addEventListener('click', function() {
      // Check if the options have already been loaded
      if (userList.options.length === 0) {
        fetch('/user-ids')
          .then(response => response.json())
          .then(data => {
            userList.innerHTML = ""; // Clear existing content

            for (var i = 0; i < data.length; i++) {
              var optionItem = document.createElement("option");
              optionItem.textContent = data[i].user_id;
              optionItem.value = data[i].uid;
              userList.appendChild(optionItem);
            }
          })
          .catch(err => console.error('Error fetching user IDs:', err));
      }
    });
  
  $(window).on("load",function() {  
  document.getElementById("user-list").addEventListener("change", function() {
    selectedUserID = this.value;
    console.log("Selected User ID:", selectedUserID);
  });
    });
  }
  


// Fetch the fridge IDs
  let selectedFridgeID = 1;

  function updateUIDValue() {
    document.getElementsByName('selectedUserID')[0].value = selectedUserID;
  }

  function fetchFridgeIDs() {
  var fridgeList = document.getElementById("fridge-list");

  // Add a click event listener to the dropdown
  fridgeList.addEventListener('click', function() {
    // Check if the options have already been loaded
    if (fridgeList.options.length === 0) {
      fetch('/fridge-ids')
        .then(response => response.json())
        .then(data => {
          fridgeList.innerHTML = ""; // Clear existing content

          for (var i = 0; i < data.length; i++) {
            var optionItem = document.createElement('option');
            optionItem.textContent = data[i].fridge_name;
            optionItem.value = data[i].fridge_id;
            fridgeList.appendChild(optionItem);
          }
        })
        .catch(err => console.error('Error fetching Fridge IDs:', err));
    }
  });

  $(window).on("load",function() {  
  document.getElementById("fridge-list").addEventListener("change", function() {
    selectedFridgeID = this.value;
    updateUIDValue();
    console.log("Selected Fridge ID:", selectedFridgeID);
  });
    });
}
  
//preload User and Fridge IDs
  $(document).ready(fetchUserIDs);
    /* document.body.addEventListener('load', fetchUserIDs); */
  console.log("fetchUserIDs preloaded")
  $(document).ready(fetchFridgeIDs);
  console.log("fetchFridgeIDs preloaded")


// new code from 21/5

function fetchFoodData() {
  fetch('/food-data')
    .then(response => response.json())
    .then(data => {
      var foodTable = document.getElementById("food-table").getElementsByTagName('tbody')[0];
      foodTable.innerHTML = ""; // Clear existing content

      for (var i = 0; i < data.length; i++) {
        var row = foodTable.insertRow();
        var selectCell = row.insertCell();
        var radio = document.createElement('input');
        radio.type = 'radio';
        radio.name = 'food-item';
        radio.value = data[i].food_id;
        selectCell.appendChild(radio);
        row.insertCell().textContent = data[i].food_id;
        row.insertCell().textContent = data[i].food_name;
        row.insertCell().textContent = data[i].qty;
        row.insertCell().textContent = data[i].expiry_date;
        row.insertCell().textContent = data[i].note;
        row.insertCell().textContent = data[i].discard ? 'Yes' : 'No';
      }
    })
    .catch(err => console.error('Error fetching food data:', err));
}

document.getElementById('delete').addEventListener('click', function() {
  var selectedFoodItem = document.querySelector('input[name="food-item"]:checked').value;
  if (confirm('Are you sure you want to delete this food item?')) {
    fetch('/delete-food', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({ food_id: selectedFoodItem }),
    })
    .then(response => response.json())
    .then(data => {
      console.log('Success:', data);
      fetchFoodData(); // Refresh the food data
    })
    .catch((error) => {
      console.error('Error:', error);
    });
  }
});

// Fetch the food data when the page loads
$(document).ready(fetchFoodData);

// end new code 21/5
</script>

</head>

<body>

    <div class="navbar">
            <a href="#home">Home</a>
            <a href="#about">About...</a>
            <a href="#contact">Contact</a>
    </div>
    <div class="grid-container">
        <div class="welcome_card">
            <h1>Welcome to PawFridge</h1>
            <p>â€“ the convenient and practical solution to managing what's in your fridge. 
            <br>stretch your paw(s) today, and no more wasted food or forgotten items!</p>
        </div>
    </div>

    <div class="grid-container">
        <div class="card1">
            <h3>Let's get started ...</h3>
            <p>Choose a user below:</p>
                <select id="user-list"></select>
                            <p><br>or sign up as a new user:</p>
            <form action="/adduser" method="post">
                <input type="text" name="user_id" placeholder="Enter your name">
                <input type="text" name="email" placeholder="Enter your email (optional)">
                <button class="plan-button" type="submit">Sign up</button>
              </form>
        </div>

      </div>
    <!-- Add other sections here -->

    <div class="grid-container">
      <div class="card2">
          <h3>Choose a fridge below:</h3>
              <select id="fridge-list"></select>
              
          <p><br>or add a new fridge:</p>
          <form action="/addfridge" method="post">
              <input type="text" name="fridge_name" placeholder="Enter the name to identify the fridge">
              <input type="number" name="selectedUserID" hidden>
              <button class="plan-button" type="submit">Add</button>
            </form>
      </div>
    </div>

<!--    <div class="grid-container">
        <div class="card3">
            <h3>Here's the contents of your fridge</h3>
                <select id="fridge-list"></select>
                  
            <p>add a food item:</p>
              <form action="/addfood" method="post">
                  <input type="text" name="fridge_name" placeholder="Enter the name to identify the fridge">
                  <button class="plan-button" type="submit">Sign up</button>
                </form>
          </div>
    
    </div>
-->

<!-- new code from 21/5 -->
<div class="grid-container">
  <div class="card3">
    <h3>Here's the contents of your fridge</h3>
    <button id="add-new">Add new</button>
    <button id="edit">Edit</button>
    <button id="delete">Delete</button>
    <table id="food-table">
      <thead>
        <tr>
          <th>Select</th>
          <th>Food ID</th>
          <th>Food Name</th>
          <th>Quantity</th>
          <th>Expiry Date</th>
          <th>Note</th>
          <th>Discard</th>
        </tr>
      </thead>
      <tbody>
        <!-- Food data will be inserted here -->
      </tbody>
    </table>
  </div>
</div>









    <div class="footer">
        <p>&copy; PawFridge. All rights reserved.</p>
        <p>Disclaimer:
            This website is created for learning purposes only. The information provided here should not be considered professional advice. Please note that we make no guarantees regarding the accuracy, completeness, or reliability of the contents of this website. Any actions you take based on the contents of this website are at your own risk. We are not liable for any losses or damages incurred from the use of this website.</p>
    </div>

</body>
</html>
